{"pageProps":{"allTags":{"bash":"bash","biohacking":"biohacking","buffer-overflow":"buffer overflow","command-injection":"command injection","development":"Development","dll-injection":"DLL Injection","domains":"domains","ee":"EE","how-to":"how to","ipv6":"IPv6","langsec":"langsec","linux":"linux","makefile":"Makefile","memory":"memory","parsing":"parsing","pcap":"pcap","phishing":"phishing","re":"RE","research":"research","rfid":"RFID","shell":"shell","story":"Story","tutorial":"Tutorial","windows-api":"Windows API","windows-hacking":"Windows Hacking"},"title":"A 9-step recipe to crack a NTLMv2 Hash from a freshly acquired .pcap","slug":"cracking-an-ntlmv2-hash","date_published":1545170400000,"date_updated":1545177514000,"tags":["how to","pcap"],"excerpt":"\n1. Open your .pcap that contains an NTLMv2 hash in Wireshark.\n2. Filter by ntlmssp to get the authentication handshake.\n\n![](2018/12/image-3.jpg \"artisanal smb2 authentication packets\")\n\n3. In this case, we get three packets. Find the NTLMSSP_AUTH packet. Filter the packet down to the Security Blob layer to get to the juicy good stuff:\n\n![](2018/12/image-5.png \"the goods\")\n\n4. Copy out the domain name and user name to a text document.\n\n5. Drill down into the NTLM Response section to find NTProofStr and NTLMv2 response. Copy both of these out to the text document as a Hex String. \n\n![](2018/12/image-6.jpg \"cross the streams\")\n\n6. Notice that NTLMv2Response begins with the ntlmProofStr, so delete the ntlmProofStr from the NTLMv2Response.\n\n![](2018/12/image-7.jpg)\n\n7. Enter ntlmssp.ntlmserverchallenge into the search filter. This will highlight the packet where the NTLM Server Challenge is found, generally the packet before the NTLM_Auth packet. Copy this value to the text document as a Hex String. \n\n![](2018/12/image-8.jpg)\n\n8. Put the values into the following format and save it as crackme.txt: \n\nusername::domain:ServerChallenge:NTproofstring:modifiedntlmv2response\n\n![](2018/12/image-12.png)\n\n9. Find your favorite password list (RockYou? best_1000_passwords2018.txt?) and open a terminal to use hashcat to run:\n\n> hashcat -m 5600 crackme.txt passwordlist.txt \n\nand it will give you the user's password!\n\n![](2018/12/image-13.png \"congrats on the hax!\")\n\nsources for more information:\n\n- [https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/](https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/)\n- [https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/](https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/)\n","cover":"2018/12/CredUIHTTPAuth.jpg","author":{"name":"kimb3r","avatar":"avatars/kimb3r.jpg"},"content":"<ol>\n<li>Open your .pcap that contains an NTLMv2 hash in Wireshark.</li>\n<li>Filter by ntlmssp to get the authentication handshake.</li>\n</ol>\n<ol start=\"3\">\n<li>In this case, we get three packets. Find the NTLMSSP_AUTH packet. Filter the packet down to the Security Blob layer to get to the juicy good stuff:</li>\n</ol>\n<ol start=\"4\">\n<li>\n<p>Copy out the domain name and user name to a text document.</p>\n</li>\n<li>\n<p>Drill down into the NTLM Response section to find NTProofStr and NTLMv2 response. Copy both of these out to the text document as a Hex String. </p>\n</li>\n</ol>\n<ol start=\"6\">\n<li>Notice that NTLMv2Response begins with the ntlmProofStr, so delete the ntlmProofStr from the NTLMv2Response.</li>\n</ol>\n<ol start=\"7\">\n<li>Enter ntlmssp.ntlmserverchallenge into the search filter. This will highlight the packet where the NTLM Server Challenge is found, generally the packet before the NTLM_Auth packet. Copy this value to the text document as a Hex String. </li>\n</ol>\n<ol start=\"8\">\n<li>Put the values into the following format and save it as crackme.txt: </li>\n</ol>\n<p>username::domain:ServerChallenge:NTproofstring:modifiedntlmv2response</p>\n<ol start=\"9\">\n<li>Find your favorite password list (RockYou? best_1000_passwords2018.txt?) and open a terminal to use hashcat to run:</li>\n</ol>\n<blockquote>\n<p>hashcat -m 5600 crackme.txt passwordlist.txt </p>\n</blockquote>\n<p>and it will give you the user's password!</p>\n<p>sources for more information:</p>\n<ul>\n<li><a href=\"https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/\">https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/</a></li>\n<li><a href=\"https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/\">https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/</a></li>\n</ul>\n"},"__N_SSG":true}