{"pageProps":{"allTags":{"biohacking":"biohacking","buffer-overflow":"buffer overflow","development":"Development","dll-injection":"DLL Injection","domains":"domains","ee":"EE","how-to":"how to","makefile":"Makefile","memory":"memory","pcap":"pcap","phishing":"phishing","re":"RE","research":"research","rfid":"RFID","story":"Story","tutorial":"Tutorial","windows-api":"Windows API","windows-hacking":"Windows Hacking"},"title":"Access-control exploitation (part 1)","slug":"access-control-exploitation-part-1","date_published":1540434784000,"date_updated":1540434915000,"tags":["research","RFID"],"excerpt":"One job I was tasked with was getting a fingerprint-based reader tested and operational for demoing our new level of hardware support for more secure facilities, 2 factor physical access control; something you are (fingerprint) and something you know or have. (pin/card)","cover":"2018/10/ugdTOpe.jpg","author":{"name":"Pips","avatar":"avatars/pips.jpg"},"content":"<h3>Fingerprint readers are silly</h3>\n<p>DISCLAIMER: I used to work for a physical security company architecting access control and surveillance solutions. </p>\n<p>One job I was tasked with was getting a fingerprint-based reader tested and operational for demoing our new level of hardware support for more secure facilities, 2 factor physical access control; something you are (fingerprint) and something you know or have. (pin/card)</p>\n<p>We were given these readers to test. The readers had a TON of wiring on the back of them. The two important things that the reader pinouts contained was</p>\n<ol>\n<li>Weigand 2-pair access control wire</li>\n<li>POE-enabled RJ45 port Â  </li>\n</ol>\n<p>The way that these readers work with existing access control systems <strong>completely invalidates</strong> the security benefits of using a fingerprint-based authentication system. Let me explain the architecture and design of this system.</p>\n<p>First, you must enrol fingerprints on the reader. You essentially scan a fingerprint a handful of times, give it a name, and assign it a badge. Wait, a badge? Yes. The reader contains a <strong>local</strong> database of every fingerprint in it's system, as well as a <strong>card </strong>associated to this fingerprint. When a fingerprint authenticates and is validated to the local database on the reader, the reader takes the card associated with that fingerprint and relays it over Wiegand wiring to an access control box. This reader is essentially functioning the exact same as a normal fingerprint-less card reader.</p>\n<figure><img src=\"/_next/static/images/Untitled-Diagram-320-85cae104007f8badea311b718b173b7a.png\" srcset=\"/_next/static/images/Untitled-Diagram-320-85cae104007f8badea311b718b173b7a.png 320w,/_next/static/images/Untitled-Diagram-471-efed0e5f00e710862e5083b3f7199924.png 471w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"471\" height=\"248\" alt=\"undefined\" loading=\"lazy\" /><figcaption>Finger is read, authenticated against a print DB, then the card associated is passed over to the access control system</figcaption></figure>\n<p>The fingerprint reader on the back end/access control provides the exact same level of authentication as a standard card-based system. If the reader is configured to pass through card reads (passthrough mode for 2nd factor, or for card or fingerprint setups) the fingerprints are <strong>completely useless</strong>.</p>\n<hr>\n<h1>Potential attack 1: network permeter comprimise</h1>\n<p>This edge device has an ethernet port. </p>\n<p>Which means it has an ethernet cable, which is going to have to tie into an internal access control network to allow it to talk to the provisioning server. Most people put their ICS on the same network. Cameras, access controls, gate controls, HVAC, etc. From the exterior of the building, you now have hardline access to an internal control network. </p>\n<p>If this network has any kind of network security (for instance, MAC address filtering), you can pull the MAC of the fingerprint reader directly from a sticker located next to the ethernet port. Spoof that MAC and you have access.</p>\n<hr>\n<h1>Potential attack 2: device fingerprint datastore compromise</h1>\n<p>The database containing <strong>fingerprint</strong> data is stored non-centrally, and every reader has a copy. The enrolment process is</p>\n<ol>\n<li>Scan fingerprint on central server</li>\n<li>Associate card, name, etc to fingerprint</li>\n<li>Push new user profile to all readers on the network</li>\n<li>Reader receives profile, adds it to internal datastore</li>\n</ol>\n<p>If you compromise the edge device (reader), you can potentially access this database through their control software, or directly through chip-off forensics. This datastore is going to not just contain fingerprint data, of which I would consider <strong>incredibly valuable and sensitive information</strong>, it would also contain all associated cards for every user profile. </p>\n<p>Unless a mass card revocation is initiated, you now also have a datastore of every functioning, authenticating, door-opening card in the system. Additionally, you may have full names, positions, teams, pictures, etc for every user.</p>\n<hr>\n<h1>Potential attack 3: Weigand man-in-the-middle</h1>\n<p>This isn't specifically a fingerprint reader specific attack, but it is just as effective. You can purchase a device that clamps onto the Weigand data wires and can Man-in-the-middle cards over the wire. With this, you can </p>\n<ul>\n<li>offload all cards as they get sent to the access control system</li>\n<li>in-line replace/denial of service on all/selected cards (lock someone out of the building)</li>\n<li>Replay a functioning card without having to have a card cloner/spoofer</li>\n</ul>\n<p>Devices like the <a href=\"https://redteamtools.com/espkey\">ESPKey</a> are cheap ($99) and usable with bluetooth or wifi.</p>\n<figure><img src=\"/_next/static/images/ugdTOpe-320-7aab7f309157675eaf6e8de8294fb6e9.jpg\" srcset=\"/_next/static/images/ugdTOpe-320-7aab7f309157675eaf6e8de8294fb6e9.jpg 320w,/_next/static/images/ugdTOpe-640-1eb3d51b015d33820c1f92d550709da4.jpg 640w,/_next/static/images/ugdTOpe-960-b8edd84f594d72ef3543294bb6f03192.jpg 960w,/_next/static/images/ugdTOpe-1280-cc0b957f3e65895de8467296a004e98f.jpg 1280w,/_next/static/images/ugdTOpe-1305-929fca021e4271936284a0ad1a2cc3c1.jpg 1305w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1305\" height=\"1290\" alt=\"undefined\" loading=\"lazy\" /><figcaption>ESPKey in-line man-in-the-middle</figcaption></figure>\n"},"__N_SSG":true}