{"pageProps":{"allTags":{"biohacking":"biohacking","buffer-overflow":"buffer overflow","development":"Development","dll-injection":"DLL Injection","domains":"domains","ee":"EE","example":"example","how-to":"how to","makefile":"Makefile","memory":"memory","pcap":"pcap","phishing":"phishing","re":"RE","research":"research","rfid":"RFID","story":"Story","windows-api":"Windows API","windows-hacking":"Windows Hacking"},"title":"A 9-step recipe to crack a NTLMv2 Hash from a freshly acquired .pcap","slug":"cracking-an-ntlmv2-hash","date_published":1545170400000,"date_updated":1545177514000,"tags":["how to","pcap"],"excerpt":"\n1. Open your .pcap that contains an NTLMv2 hash in Wireshark.\n2. Filter by ntlmssp to get the authentication handshake.\n\n![](2018/12/image-3.jpg \"artisanal smb2 authentication packets\")\n\n3. In this case, we get three packets. Find the NTLMSSP_AUTH packet. Filter the packet down to the Security Blob layer to get to the juicy good stuff:\n\n![](2018/12/image-5.png \"the goods\")\n\n4. Copy out the domain name and user name to a text document.\n\n5. Drill down into the NTLM Response section to find NTProofStr and NTLMv2 response. Copy both of these out to the text document as a Hex String. \n\n![](2018/12/image-6.jpg \"cross the streams\")\n\n6. Notice that NTLMv2Response begins with the ntlmProofStr, so delete the ntlmProofStr from the NTLMv2Response.\n\n![](2018/12/image-7.jpg)\n\n7. Enter ntlmssp.ntlmserverchallenge into the search filter. This will highlight the packet where the NTLM Server Challenge is found, generally the packet before the NTLM_Auth packet. Copy this value to the text document as a Hex String. \n\n![](2018/12/image-8.jpg)\n\n8. Put the values into the following format and save it as crackme.txt: \n\nusername::domain:ServerChallenge:NTproofstring:modifiedntlmv2response\n\n![](2018/12/image-12.png)\n\n9. Find your favorite password list (RockYou? best_1000_passwords2018.txt?) and open a terminal to use hashcat to run:\n\n> hashcat -m 5600 crackme.txt passwordlist.txt \n\nand it will give you the user's password!\n\n![](2018/12/image-13.png \"congrats on the hax!\")\n\nsources for more information:\n\n- [https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/](https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/)\n- [https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/](https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/)\n","cover":"2018/12/CredUIHTTPAuth.jpg","author":{"name":"kimb3r","avatar":"avatars/kimb3r.jpg"},"content":"<ol>\n<li>Open your .pcap that contains an NTLMv2 hash in Wireshark.</li>\n<li>Filter by ntlmssp to get the authentication handshake.</li>\n</ol>\n<figure><img src=\"/_next/static/images/image-3-320-83b5f4c59a04cd3bd062e0e02fba8473.jpg\" srcset=\"/_next/static/images/image-3-320-83b5f4c59a04cd3bd062e0e02fba8473.jpg 320w,/_next/static/images/image-3-640-8566a8be16021e04b6108bb827a77485.jpg 640w,/_next/static/images/image-3-960-b9296320d64fbf99877696282e83875a.jpg 960w,/_next/static/images/image-3-1280-bd3cdb397e051a3b7c196e0fce19804d.jpg 1280w,/_next/static/images/image-3-1900-305d98fa95c779b883251cb2ab80e655.jpg 1900w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1900\" height=\"325\" alt=\"undefined\" loading=\"lazy\" /><figcaption>artisanal smb2 authentication packets</figcaption></figure>\n<ol start=\"3\">\n<li>In this case, we get three packets. Find the NTLMSSP_AUTH packet. Filter the packet down to the Security Blob layer to get to the juicy good stuff:</li>\n</ol>\n<figure><img src=\"/_next/static/images/image-5-320-9f71e4132aca9d0f73e383a3a2a21c7c.png\" srcset=\"/_next/static/images/image-5-320-9f71e4132aca9d0f73e383a3a2a21c7c.png 320w,/_next/static/images/image-5-640-feea227b80a2f9e65a18c0c34d36ba90.png 640w,/_next/static/images/image-5-960-60f0d3be809f45d2a7b81a086374c196.png 960w,/_next/static/images/image-5-1280-b2b0cbee65eba34261df150f12bfe937.png 1280w,/_next/static/images/image-5-1526-ae3bc1a20d14c752dc9dc76f9565e4fb.png 1526w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1526\" height=\"1098\" alt=\"undefined\" loading=\"lazy\" /><figcaption>the goods</figcaption></figure>\n<ol start=\"4\">\n<li>\n<p>Copy out the domain name and user name to a text document.</p>\n</li>\n<li>\n<p>Drill down into the NTLM Response section to find NTProofStr and NTLMv2 response. Copy both of these out to the text document as a Hex String. </p>\n</li>\n</ol>\n<figure><img src=\"/_next/static/images/image-6-320-f01008e195d2bd8b496407718c88fc4e.jpg\" srcset=\"/_next/static/images/image-6-320-f01008e195d2bd8b496407718c88fc4e.jpg 320w,/_next/static/images/image-6-640-1fc6cd8489b25c104eb4056884ee19aa.jpg 640w,/_next/static/images/image-6-960-f7be056253269d8e5e9e73cc1468c63d.jpg 960w,/_next/static/images/image-6-1280-862df5b8f8b85c74ff70492ba0744c07.jpg 1280w,/_next/static/images/image-6-1442-ceb0beca514bf7968f6484d55cbd9e9c.jpg 1442w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1442\" height=\"1014\" alt=\"undefined\" loading=\"lazy\" /><figcaption>cross the streams</figcaption></figure>\n<ol start=\"6\">\n<li>Notice that NTLMv2Response begins with the ntlmProofStr, so delete the ntlmProofStr from the NTLMv2Response.</li>\n</ol>\n<img src=\"/_next/static/images/image-7-320-03bd8dc962e91006a4fe5716b61fb9e2.jpg\" srcset=\"/_next/static/images/image-7-320-03bd8dc962e91006a4fe5716b61fb9e2.jpg 320w,/_next/static/images/image-7-640-1291a00512c02e96a3018f8d2b05a296.jpg 640w,/_next/static/images/image-7-960-6f52c8396ea7cf709f2df00eb64f982b.jpg 960w,/_next/static/images/image-7-1280-b2559fe7b56f42ca76b99dd530485bc8.jpg 1280w,/_next/static/images/image-7-1900-3aa982e0c464818e143437c31e8bdbe2.jpg 1900w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1900\" height=\"389\" alt=\"undefined\" loading=\"lazy\" />\n<ol start=\"7\">\n<li>Enter ntlmssp.ntlmserverchallenge into the search filter. This will highlight the packet where the NTLM Server Challenge is found, generally the packet before the NTLM_Auth packet. Copy this value to the text document as a Hex String. </li>\n</ol>\n<img src=\"/_next/static/images/image-8-320-2cb0f03682e8a04533192417f56964c9.jpg\" srcset=\"/_next/static/images/image-8-320-2cb0f03682e8a04533192417f56964c9.jpg 320w,/_next/static/images/image-8-640-9e8d06edda0b4b93b43ebabae242bc5c.jpg 640w,/_next/static/images/image-8-960-950f0fdb2282b01a89d0ec44d3a860fd.jpg 960w,/_next/static/images/image-8-1280-f0d82849f9abafd8ccbb6eb175b19d8a.jpg 1280w,/_next/static/images/image-8-1900-1898d1ea6b8a5208f66d01e30c43cfa8.jpg 1900w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1900\" height=\"1083\" alt=\"undefined\" loading=\"lazy\" />\n<ol start=\"8\">\n<li>Put the values into the following format and save it as crackme.txt: </li>\n</ol>\n<p>username::domain:ServerChallenge:NTproofstring:modifiedntlmv2response</p>\n<img src=\"/_next/static/images/image-12-320-d1966be191cd8ff97b1de754205a53f6.png\" srcset=\"/_next/static/images/image-12-320-d1966be191cd8ff97b1de754205a53f6.png 320w,/_next/static/images/image-12-640-7ac4050f1cabe061e9d92f51ba8183d4.png 640w,/_next/static/images/image-12-960-76613eb890590382850204172f834a17.png 960w,/_next/static/images/image-12-1202-2eaa563435bd2988934a22787a3953ed.png 1202w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1202\" height=\"374\" alt=\"undefined\" loading=\"lazy\" />\n<ol start=\"9\">\n<li>Find your favorite password list (RockYou? best_1000_passwords2018.txt?) and open a terminal to use hashcat to run:</li>\n</ol>\n<blockquote>\n<p>hashcat -m 5600 crackme.txt passwordlist.txt </p>\n</blockquote>\n<p>and it will give you the user's password!</p>\n<figure><img src=\"/_next/static/images/image-13-320-54f0504ca0849cd4ee85be74e1c7d631.png\" srcset=\"/_next/static/images/image-13-320-54f0504ca0849cd4ee85be74e1c7d631.png 320w,/_next/static/images/image-13-640-e5660420b0608dea12a5142a8c20bb26.png 640w,/_next/static/images/image-13-960-730594b8fd96f1be454751d627211135.png 960w,/_next/static/images/image-13-1146-3aa1ed97ec5e60b07dcda2544b41aceb.png 1146w\" sizes=\"(min-width: 960px) 960px, 100vw\" width=\"1146\" height=\"186\" alt=\"undefined\" loading=\"lazy\" /><figcaption>congrats on the hax!</figcaption></figure>\n<p>sources for more information:</p>\n<ul>\n<li><a href=\"https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/\">https://www.root9b.com/newsroom/attacking-windows-fallback-authentication/</a></li>\n<li><a href=\"https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/\">https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/</a></li>\n</ul>\n"},"__N_SSG":true}